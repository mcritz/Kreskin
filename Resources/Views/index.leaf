<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Kreskin</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.1/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.min.js"></script>
</head>
<body>
<header class="container">
	<h1>KRZKN</h1>
    <h2>Hello, #(name)</h2>
</header>

<section id="signup" class="container" v-model="user" v-if="isActive">
    <div class="row col-3">
        <h3>Sign Up</h3>
        <div class="form-group">
            <label for="name">Your name</label>
            <input id="name" 
                type="text" 
                name="name" 
                class="form-control" 
                placeholder="Your name"
                v-model="user.name"
                required
            >
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input id="email" 
                type="email" 
                name="email" 
                class="form-control" 
                placeholder="email"
                v-model="user.email"
                required
            >
        </div>
        
        <div class="form-group">
            <label for="password">Password</label>
            <input id="password" 
                type="password" 
                class="form-control" 
                name="password"
                v-model="user.password"
                required
            >
        </div>

        <div class="form-group">
            <input id="signup-btn"
                type="submit" 
                class="btn btn-primary" 
                value="Sign Up"
                v-on:click="signup()"
            >
        </div>
    </div>
</section>
<script>
var LoginView = new Vue({
    el: '\#signup',
    data: {
        isActive: true,
        user: {
            name: '',
            email: '',
            password: ''
        }
    },
    mounted: function() {

    },
    methods: {
        ping: function(evt) {
            console.log('clicked');
            console.log('name', this.user.name);
            console.log('email', this.user.email);
            console.log('password', this.user.password);
        },
        signup: function(evt) {
            axios.post('/users', {
                email: this.user.email,
                name: this.user.name,
                password: this.user.password
            }).then(response => {
                console.log('signup', response);
                this.login();
            }).catch(error => {
                console.log('fail', error);
            });
        },
        login: function(evt) {
            console.log('login', this.user);
            axios({
                method: 'post',
                url: '/login',
                auth: {
                    username: this.user.email,
                    password: this.user.password
                }
            }).then(response => {
                console.log('login', response);
                this.isActive = false;
                window.localStorage.setItem('auth_token', response.data.token);
            }).catch(error => {
                console.log('failed login', error);
            });
        }
    }
});
</script>

<div id="predictions" class="container">
    <prediction-comp 
        v-for="prediction in predictions"
        v-bind:prediction="prediction"
        v-bind:key="prediction.id"
        v-on:reveal="update(prediction)"
    >
    </prediction-comp>
</div>

<script src="js/app.js"></script>
</body>
</html>
